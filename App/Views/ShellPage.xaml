<Page
    x:Class="App.Views.ShellPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:App.ViewModels"
    mc:Ignorable="d"
    x:Name="ShellPageInstance">

    <Page.Resources>
        <!-- A reusable style for compact, bordered, square navigation buttons. -->
        <Style x:Key="NavigationButtonStyle" TargetType="Button">
            <!-- CHANGE: Set Height and Width to be equal and smaller than the user icon. -->
            <Setter Property="Height" Value="28" />
            <Setter Property="Width" Value="28" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>
    </Page.Resources>

    <Page.KeyboardAccelerators>
        <KeyboardAccelerator Key="W" Modifiers="Control" Invoked="CloseTab_Invoked" />
        <KeyboardAccelerator Key="Tab" Modifiers="Control" Invoked="NextTab_Invoked" />
        <KeyboardAccelerator Key="Tab" Modifiers="Control,Shift" Invoked="PreviousTab_Invoked" />
    </Page.KeyboardAccelerators>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Row 0: Title Bar and Tab View -->
        <Grid Grid.Row="0" Height="40" AllowDrop="True" DragOver="TabStripArea_DragOver" Drop="TabStripArea_Drop">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="188" />
            </Grid.ColumnDefinitions>

            <TabView Grid.Column="0" x:Name="Tabs" VerticalAlignment="Top" TabItemsSource="{x:Bind ViewModel.Tabs}"
                     SelectedItem="{x:Bind ViewModel.SelectedTab, Mode=TwoWay}" IsAddTabButtonVisible="False"
                     TabCloseRequested="Tabs_TabCloseRequested" CanDragTabs="True" AllowDropTabs="True"
                     TabDragStarting="Tabs_TabDragStarting" TabStripDragOver="Tabs_TabStripDragOver"
                     TabStripDrop="Tabs_TabStripDrop" TabDroppedOutside="Tabs_TabDroppedOutside"
                     TabDragCompleted="Tabs_TabDragCompleted">

                <TabView.TabItemTemplate>
                    <DataTemplate x:DataType="viewmodels:TabViewModel">
                        <TabViewItem Header="{x:Bind Header}" />
                    </DataTemplate>
                </TabView.TabItemTemplate>

                <TabView.TabStripHeader>
                    <Grid x:Name="ShellTitleBar" MinHeight="40" Background="Transparent">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="12" Margin="12,0,12,0">
                            <Image Source="/Assets/WindowIcon.ico" Width="16" Height="16" />
                            <StackPanel VerticalAlignment="Center" >
                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.Title, Mode=OneWay}" />
                                <TextBlock FontSize="10" Text="{x:Bind ViewModel.Subtitle, Mode=OneWay}" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </TabView.TabStripHeader>

                <TabView.TabStripFooter >
                    <DropDownButton AutomationProperties.Name="Add Tab" Margin="0,2,4,0" Height="28">
                        <DropDownButton.Content >
                            <FontIcon Glyph="&#xE710;" FontSize="16"/>
                        </DropDownButton.Content>
                        <DropDownButton.Flyout>
                            <MenuFlyout x:Name="AddTabMenuFlyout" Placement="Bottom" Opening="AddTabMenuFlyout_Opening" />
                        </DropDownButton.Flyout>
                    </DropDownButton>
                </TabView.TabStripFooter>
            </TabView>
        </Grid>

        <!-- Row 1: Command Bar -->
        <Grid Grid.Row="1" x:Name="SecondRow" Height="48" Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8" Margin="12,0,0,0">
                <Button Command="{x:Bind ViewModel.GoBackCommand}"
                        Style="{StaticResource NavigationButtonStyle}"
                        ToolTipService.ToolTip="Back">
                    <SymbolIcon Symbol="Back" />
                </Button>
                <Button Command="{x:Bind ViewModel.GoForwardCommand}"
                        Style="{StaticResource NavigationButtonStyle}"
                        ToolTipService.ToolTip="Forward">
                    <SymbolIcon Symbol="Forward" />
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="1" x:Name="SecondRowContent" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,12,0">
                <AutoSuggestBox Width="360" VerticalAlignment="Center" PlaceholderText="Search..." QueryIcon="Find" />

                <DropDownButton VerticalAlignment="Center" Padding="0" BorderThickness="0" Background="Transparent">
                    <DropDownButton.Content>
                        <PersonPicture Width="30" Height="30" Initials="JD" />
                    </DropDownButton.Content>
                    <DropDownButton.Flyout>
                        <MenuFlyout Placement="BottomEdgeAlignedRight">
                            <MenuFlyoutItem Text="Settings" Click="SettingsMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Setting" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="Profile">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Contact" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Text="Sign Out">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Switch" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>
            </StackPanel>
        </Grid>

        <!-- Row 2: Main Content Area -->
        <ContentPresenter
            Grid.Row="2"
            Margin="24"
            Content="{x:Bind ViewModel.SelectedTab.NavigationFrame, Mode=OneWay}" />
    </Grid>
</Page>
    